<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ì´í„°ë² ì´ìŠ¤ í…ŒìŠ¤íŠ¸ - í”„ë†ˆíœ í•œì‹ë‹¹</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .header h1 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .test-section h3 {
            color: #667eea;
            margin-bottom: 1rem;
        }

        .status {
            padding: 0.5rem 1rem;
            border-radius: 5px;
            margin: 0.5rem 0;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .test-button {
            background: #667eea;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
            transition: all 0.3s ease;
        }

        .test-button:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .log {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .data-display {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ ë°ì´í„°ë² ì´ìŠ¤ í…ŒìŠ¤íŠ¸</h1>
            <p>Firebaseì™€ ë¡œì»¬ ì €ì¥ì†Œ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤</p>
        </div>

        <div class="test-section">
            <h3>1. Firebase ì—°ê²° ìƒíƒœ</h3>
            <div id="firebaseStatus"></div>
            <button class="test-button" onclick="testFirebaseConnection()">Firebase ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        </div>

        <div class="test-section">
            <h3>2. ë¡œì»¬ ì €ì¥ì†Œ í…ŒìŠ¤íŠ¸</h3>
            <div id="localStorageStatus"></div>
            <button class="test-button" onclick="testLocalStorage()">ë¡œì»¬ ì €ì¥ì†Œ í…ŒìŠ¤íŠ¸</button>
        </div>

        <div class="test-section">
            <h3>3. ë°ì´í„° ì €ì¥/ì¡°íšŒ í…ŒìŠ¤íŠ¸</h3>
            <div id="dataTestStatus"></div>
            <button class="test-button" onclick="testDataOperations()">ë°ì´í„° ì‘ì—… í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="clearTestData()">í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ</button>
        </div>

        <div class="test-section">
            <h3>4. í˜„ì¬ ì €ì¥ëœ ì˜ˆì•½ ë°ì´í„°</h3>
            <div id="currentData"></div>
            <button class="test-button" onclick="loadCurrentData()">ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <div class="test-section">
            <h3>5. ì‹œìŠ¤í…œ ë¡œê·¸</h3>
            <div class="log" id="systemLog"></div>
            <button class="test-button" onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        </div>
    </div>

    <!-- Firebase SDK CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        let logContainer = document.getElementById('systemLog');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            logContainer.textContent += logMessage;
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function testFirebaseConnection() {
            log('Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            try {
                if (typeof firebase === 'undefined') {
                    showStatus('firebaseStatus', 'âŒ Firebase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                    log('Firebase SDK ë¡œë“œ ì‹¤íŒ¨', 'error');
                    return;
                }

                if (typeof window.firebaseApp === 'undefined') {
                    showStatus('firebaseStatus', 'âŒ Firebase ì•±ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                    log('Firebase ì•± ì´ˆê¸°í™” ì‹¤íŒ¨', 'error');
                    return;
                }

                // Firebase ì„¤ì • í™•ì¸
                const config = {
                    apiKey: "AIzaSyBxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
                    authDomain: "your-project-name.firebaseapp.com",
                    projectId: "your-project-name"
                };

                // ë°ëª¨ ì„¤ì •ì¸ì§€ í™•ì¸
                if (config.apiKey === "AIzaSyBxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" || 
                    config.projectId === "your-project-name") {
                    showStatus('firebaseStatus', 'âš ï¸ Firebase ë°ëª¨ ì„¤ì •ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤ì œ í”„ë¡œì íŠ¸ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning');
                    log('Firebase ë°ëª¨ ì„¤ì • ì‚¬ìš© ì¤‘', 'warning');
                    log('ğŸ“ Firebase ì½˜ì†”(https://console.firebase.google.com)ì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  ì„¤ì •ê°’ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.', 'info');
                    log(`í˜„ì¬ API Key: ${config.apiKey}`, 'info');
                    log(`í˜„ì¬ Project ID: ${config.projectId}`, 'info');
                } else {
                    showStatus('firebaseStatus', 'âœ… Firebase ì‹¤ì œ ì„¤ì •ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                    log('Firebase ì‹¤ì œ ì„¤ì • ì‚¬ìš© ì¤‘', 'success');
                    log(`API Key: ${config.apiKey.substring(0, 10)}...`, 'info');
                    log(`Project ID: ${config.projectId}`, 'info');
                }

            } catch (error) {
                showStatus('firebaseStatus', `âŒ Firebase ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error');
                log(`Firebase ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        function testLocalStorage() {
            log('ë¡œì»¬ ì €ì¥ì†Œ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            try {
                // ë¡œì»¬ ì €ì¥ì†Œ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
                if (typeof Storage === 'undefined') {
                    showStatus('localStorageStatus', 'âŒ ë¡œì»¬ ì €ì¥ì†Œë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤', 'error');
                    log('ë¡œì»¬ ì €ì¥ì†Œ ë¯¸ì§€ì›', 'error');
                    return;
                }

                // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥
                const testData = {
                    id: 'test_' + Date.now(),
                    name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
                    phone: '010-1234-5678',
                    date: '2024-01-01',
                    time: '12:00',
                    guests: '2',
                    status: 'test',
                    createdAt: new Date().toISOString()
                };

                localStorage.setItem('test_reservation', JSON.stringify(testData));
                
                // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì½ê¸°
                const retrievedData = JSON.parse(localStorage.getItem('test_reservation'));
                
                if (retrievedData && retrievedData.id === testData.id) {
                    showStatus('localStorageStatus', 'âœ… ë¡œì»¬ ì €ì¥ì†Œê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤', 'success');
                    log('ë¡œì»¬ ì €ì¥ì†Œ í…ŒìŠ¤íŠ¸ ì„±ê³µ', 'success');
                } else {
                    showStatus('localStorageStatus', 'âŒ ë¡œì»¬ ì €ì¥ì†Œ ë°ì´í„° ì½ê¸°/ì“°ê¸° ì˜¤ë¥˜', 'error');
                    log('ë¡œì»¬ ì €ì¥ì†Œ ë°ì´í„° ë¶ˆì¼ì¹˜', 'error');
                }

                // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ
                localStorage.removeItem('test_reservation');

            } catch (error) {
                showStatus('localStorageStatus', `âŒ ë¡œì»¬ ì €ì¥ì†Œ ì˜¤ë¥˜: ${error.message}`, 'error');
                log(`ë¡œì»¬ ì €ì¥ì†Œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        async function testDataOperations() {
            log('ë°ì´í„° ì‘ì—… í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            try {
                const testReservation = {
                    name: 'í…ŒìŠ¤íŠ¸ ì˜ˆì•½ì',
                    phone: '010-9999-8888',
                    email: 'test@example.com',
                    date: '2024-12-31',
                    time: '18:00',
                    guests: '4',
                    table: 'window',
                    special: 'í…ŒìŠ¤íŠ¸ ì˜ˆì•½ì…ë‹ˆë‹¤'
                };

                // ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸
                log('ì˜ˆì•½ ë°ì´í„° ì €ì¥ ì‹œë„...');
                const saveResult = await window.firebaseApp.saveReservation(testReservation);
                
                if (saveResult && saveResult.success) {
                    showStatus('dataTestStatus', 'âœ… ë°ì´í„° ì €ì¥ ì„±ê³µ', 'success');
                    log(`ì €ì¥ ì„±ê³µ: ID ${saveResult.id}`, 'success');
                    
                    // ë°ì´í„° ì¡°íšŒ í…ŒìŠ¤íŠ¸
                    log('ì €ì¥ëœ ë°ì´í„° ì¡°íšŒ ì‹œë„...');
                    const loadResult = await window.firebaseApp.getAllReservations();
                    
                    if (loadResult && loadResult.success) {
                        const testData = loadResult.data.find(item => item.phone === testReservation.phone);
                        if (testData) {
                            showStatus('dataTestStatus', 'âœ… ë°ì´í„° ì €ì¥ ë° ì¡°íšŒ ì„±ê³µ', 'success');
                            log('ë°ì´í„° ì¡°íšŒ ì„±ê³µ', 'success');
                        } else {
                            showStatus('dataTestStatus', 'âš ï¸ ë°ì´í„° ì €ì¥ì€ ì„±ê³µí–ˆì§€ë§Œ ì¡°íšŒì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'warning');
                            log('ì €ì¥ëœ ë°ì´í„°ë¥¼ ì¡°íšŒì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'warning');
                        }
                    } else {
                        showStatus('dataTestStatus', 'âŒ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨', 'error');
                        log('ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨', 'error');
                    }
                } else {
                    showStatus('dataTestStatus', `âŒ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨: ${saveResult?.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                    log(`ë°ì´í„° ì €ì¥ ì‹¤íŒ¨: ${saveResult?.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                }

            } catch (error) {
                showStatus('dataTestStatus', `âŒ ë°ì´í„° ì‘ì—… ì˜¤ë¥˜: ${error.message}`, 'error');
                log(`ë°ì´í„° ì‘ì—… ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        async function loadCurrentData() {
            log('í˜„ì¬ ì €ì¥ëœ ë°ì´í„° ë¡œë“œ ì¤‘...');
            
            try {
                const result = await window.firebaseApp.getAllReservations();
                
                if (result && result.success) {
                    const dataContainer = document.getElementById('currentData');
                    
                    if (result.data.length === 0) {
                        dataContainer.innerHTML = '<div class="status info">ì €ì¥ëœ ì˜ˆì•½ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                        log('ì €ì¥ëœ ë°ì´í„° ì—†ìŒ', 'info');
                    } else {
                        dataContainer.innerHTML = `
                            <div class="status success">ì´ ${result.data.length}ê°œì˜ ì˜ˆì•½ ë°ì´í„°ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤</div>
                            <div class="data-display">
                                <pre>${JSON.stringify(result.data, null, 2)}</pre>
                            </div>
                        `;
                        log(`${result.data.length}ê°œì˜ ì˜ˆì•½ ë°ì´í„° ë¡œë“œ ì™„ë£Œ`, 'success');
                    }
                } else {
                    showStatus('currentData', `âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${result?.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                    log(`ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${result?.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                }

            } catch (error) {
                showStatus('currentData', `âŒ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: ${error.message}`, 'error');
                log(`ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        function clearTestData() {
            log('í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ ì¤‘...');
            
            try {
                // ë¡œì»¬ ì €ì¥ì†Œì—ì„œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ
                const reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
                const filteredReservations = reservations.filter(item => 
                    !item.phone.includes('9999') && 
                    !item.name.includes('í…ŒìŠ¤íŠ¸')
                );
                localStorage.setItem('reservations', JSON.stringify(filteredReservations));
                
                showStatus('dataTestStatus', 'âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                log('í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ ì™„ë£Œ', 'success');
                
                // í˜„ì¬ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                loadCurrentData();

            } catch (error) {
                showStatus('dataTestStatus', `âŒ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ ì˜¤ë¥˜: ${error.message}`, 'error');
                log(`í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        function clearLog() {
            logContainer.textContent = '';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            log('ë°ì´í„°ë² ì´ìŠ¤ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            testFirebaseConnection();
            testLocalStorage();
            loadCurrentData();
        });
    </script>
</body>
</html>
